# CANtina

In order to interact with the service, you first have to figure out
how it works. Here is some general information to get you started.
If you want to use the `docker-compose.yml` for local testing, make
sure to have a SocketCAN interface `vcan0` running on your machine.

Run the following commands to enable `vcan0` interface on ubuntu server:
```sh
sudo apt-get install -y linux-modules-extra-$(uname -r)
sudo modprobe vcan
sudo ip link add dev vcan0 type vcan
sudo ip link set up vcan0
ip addr | grep "can"
```


## Proof of Work

A lot of things are gated behind a proof of work. The proof of work is
solved using the following python snippet: 

```python
def calculate_pow(pow_message):
    pow_message['Salt'] = b64decode(pow_message['Salt'])
    salt_int = int.from_bytes(pow_message['Salt'], "big")
    for x in range(2**pow_message['Difficulty']):
        value = x + salt_int
        target = value.to_bytes(len(pow_message['Salt']), "big")
        hashed_candidate = hashlib.sha256(target).hexdigest()
        if pow_message['Hash'] == hashed_candidate:
            return x
```

Together with the following snippet, you can directly get a ticket
from the order page, instead of using the PoW in the browser; this
should be a lot faster than waiting on the tokens in the browser.

```python
def get_ticket(base_url) -> bytes:
    with requests.Session() as s:
        r = s.post(f'{base_url}/create_pow')
        pow_message = r.json()
        pow_solution = calculate_pow(pow_message)
        r = s.post(f'{base_url}/ticket', json={
            'pow-solution': pow_solution
        })
        return b64decode(r.json()['ticket'])
```

## Interacting with the Gateway Server

The gateway server is used to access certain functionallities of the services. 
Interaction is based on messages. To help you out with this, you can check out `message.py`,
which contains a list of all possible messages that can be received by
or sent to the gateway server. The gateway is simply part of the infrastructure, and
not directly a part of the service.

## Flag-IDs for Flagstore 1

The flag IDs for the first flagstore correspond to the order ID
generated by the order terminal, when you create a valid order.


## Flag-IDs for Flagstore 2

The flag IDs for the second flagstore are the filenames 
for stored uploaded files on the Jukebox.

